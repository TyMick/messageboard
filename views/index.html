<!DOCTYPE html>
<html lang="en">
  <!-- prettier-ignore -->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link id="favicon" rel="icon" href="https://cdn.glitch.com/b5ad4fa7-df0f-4fe3-9ff7-e907bc715af0%2Ffavicon.ico?v=1580396682134" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/default.min.css" />

    <title>Anonymous message board â€“ Ty Mick</title>
  </head>

  <body style="background-color: #dee2e6;">
    <div class="container my-5">
      <h1 class="mb-4">Anonymous message board microservice</h1>

      <!-- API test front end -->
      <div class="card mb-4">
        <div class="card-body">
          <h3 class="mb-4">Test this API:</h3>

          <h4 class="mb-3">Thread API tests</h4>

          <!-- Set board name for thread tests -->
          <form id="setThreadBoard" class="was-validated mb-4">
            <div class="form-group">
              <label for="threadBoard"
                >Set the message board name for all tests below</label
              >
              <div class="input-group">
                <div class="input-group-prepend">
                  <div class="input-group-text">/api/threads/</div>
                </div>
                <input
                  id="threadBoard"
                  name="board"
                  type="text"
                  class="form-control"
                  style="max-width: 12rem;"
                  required
                />
              </div>
            </div>
          </form>

          <!-- Add new thread -->
          <form id="addNewThread" class="mb-4">
            <h5>Create a new message thread</h5>
            <div class="form-row">
              <div class="form-group col-md">
                <label for="threadPostText">Text</label>
                <textarea
                  class="form-control"
                  id="threadPostText"
                  name="text"
                  required
                ></textarea>
              </div>
              <div class="form-group col-md">
                <label for="threadPostDeletePassword">Password to delete</label>
                <input
                  type="text"
                  class="form-control"
                  id="threadPostDeletePassword"
                  name="delete_password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">POST</button>
          </form>

          <!-- Get recent threads -->
          <form id="getRecentThreads" class="mb-4">
            <h5>Get a list of recent threads</h5>
            <button type="submit" class="btn btn-primary">GET</button>
          </form>

          <!-- Report thread -->
          <form id="reportThread" class="mb-4">
            <h5>Report a thread</h5>
            <div class="form-group">
              <label for="threadPutId">Thread <code>_id</code></label>
              <input
                type="text"
                class="form-control"
                id="threadPutId"
                name="thread_id"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">PUT</button>
          </form>

          <!-- Delete thread -->
          <form id="deleteThread" class="mb-5">
            <h5>Delete a thread</h5>
            <div class="form-row">
              <div class="form-group col-sm">
                <label for="threadDeleteId">Thread <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="threadDeleteId"
                  name="thread_id"
                  required
                />
              </div>
              <div class="form-group col-sm">
                <label for="threadDeletePassword">Delete password</label>
                <input
                  type="text"
                  class="form-control"
                  id="threadDeletePassword"
                  name="delete_password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">DELETE</button>
          </form>

          <h4 class="mb-3">Reply API tests</h4>

          <!-- Set board name for reply tests -->
          <form id="setReplyBoard" class="was-validated mb-4">
            <div class="form-group">
              <label for="replyBoard"
                >Set the message board name for all tests below</label
              >
              <div class="input-group">
                <div class="input-group-prepend">
                  <div class="input-group-text">/api/replies/</div>
                </div>
                <input
                  id="replyBoard"
                  name="board"
                  type="text"
                  class="form-control"
                  style="max-width: 12rem;"
                  required
                />
              </div>
            </div>
          </form>

          <!-- Add new reply -->
          <form id="addNewReply" class="mb-4">
            <h5>Reply to a thread</h5>
            <div class="form-row">
              <div class="form-group order-sm-2 col-sm-6 order-lg-1 col-lg-3">
                <label for="replyPostThreadId">Thread <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="postReplyThreadId"
                  name="thread_id"
                  required
                />
              </div>
              <div class="form-group order-sm-1 col-sm-12 order-lg-2 col-lg-6">
                <label for="replyPostText">Reply text</label>
                <textarea
                  class="form-control"
                  id="replyPostText"
                  name="text"
                  required
                ></textarea>
              </div>
              <div class="form-group order-sm-3 col-sm-6 order-lg-3 col-lg-3">
                <label for="replyPostDeletePassword"
                  >Password to delete reply</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="replyPostDeletePassword"
                  name="delete_password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">POST</button>
          </form>

          <!-- Get thread and replies -->
          <form id="getThreadAndReplies" class="mb-4">
            <h5>Show one thread and its replies</h5>
            <div class="form-row">
              <div
                class="col-sm mr-1 mr-sm-3 mb-3 mb-sm-0"
                style="max-width: 23.5rem;"
              >
                <label for="replyGetThreadId" class="sr-only"
                  >Thread <code>_id</code></label
                >
                <div class="input-group">
                  <div class="input-group-prepend">
                    <div class="input-group-text">?thread_id=</div>
                  </div>
                  <input
                    type="text"
                    class="form-control"
                    id="replyGetThreadId"
                    name="thread_id"
                    required
                  />
                </div>
              </div>
              <div class="col-sm-auto">
                <button type="submit" class="btn btn-primary">GET</button>
              </div>
            </div>
          </form>

          <!-- Report reply -->
          <form id="reportReply" class="mb-4">
            <h5>Report a reply</h5>
            <div class="form-row">
              <div class="form-group col-sm">
                <label for="replyPutThreadId">Thread <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="replyPutThreadId"
                  name="thread_id"
                  required
                />
              </div>
              <div class="form-group col-sm">
                <label for="replyPutId">Reply <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="replyPutId"
                  name="reply_id"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">PUT</button>
          </form>

          <!-- Delete reply -->
          <form id="deleteReply">
            <h5>Delete a reply</h5>
            <div class="form-row">
              <div class="form-group col-sm-6 col-md">
                <label for="replyDeleteThreadId">Thread <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="replyDeleteThreadId"
                  name="thread_id"
                  required
                />
              </div>
              <div class="form-group col-sm-6 col-md">
                <label for="replyDeleteId">Reply <code>_id</code></label>
                <input
                  type="text"
                  class="form-control"
                  id="replyDeleteId"
                  name="reply_id"
                  required
                />
              </div>
              <div class="form-group col-sm-6 col-md">
                <label for="replyDeletePassword">Reply delete password</label>
                <input
                  type="text"
                  class="form-control"
                  id="replyDeletePassword"
                  name="delete_password"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">DELETE</button>
          </form>

          <!-- API output -->
          <div
            class="modal fade"
            id="apiOutputModal"
            tabindex="-1"
            role="dialog"
            aria-labelledby="apiOutputLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="apiOutputLabel">
                    API response for project
                    <span id="outputProjectName"></span>:
                  </h5>
                  <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-label="Close"
                  >
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <pre id="apiOutput" class="hljs bg-white mb-0"></pre>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-dismiss="modal"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Explanation -->
      <p class="lead font-italic">
        View the source on
        <a href="https://github.com/tywmick/messageboard">GitHub</a> or
        <a href="https://glitch.com/edit/#!/ty-messageboard">Glitch</a>.
      </p>

      <p>
        I created this microservice as a requirement for
        <a
          href="https://www.freecodecamp.org/certification/tywmick/information-security-and-quality-assurance"
          >my freeCodeCamp Information Security and Quality Assurance
          Certification</a
        >, using <a href="https://nodejs.org/en/">Node.js</a>,
        <a href="https://expressjs.com/">Express</a>,
        <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB</a>,
        <a href="https://www.chaijs.com/">Chai</a>, and
        <a href="https://helmetjs.github.io/">Helmet</a>. The front end API
        tests on the home page also use
        <a href="https://getbootstrap.com/">Bootstrap</a>,
        <a href="https://jquery.com/">jQuery</a>, and
        <a href="https://highlightjs.org/">highlight.js</a>.
      </p>

      <p>
        You can read the functional tests I wrote on
        <a
          href="https://github.com/tywmick/messageboard/tree/glitch/tests/2_functional-tests.js"
          >GitHub</a
        >
        or
        <a
          href="https://glitch.com/edit/#!/ty-messageboard?path=tests/2_functional-tests.js"
          >Glitch</a
        >. To run the tests yourself, create a MongoDB database, fork/remix this
        project, create a <code>.env</code> file with
        <code>DB="{your MongoDB connection string}"</code> and
        <code>NODE_ENV="test"</code>, start the server, and look at the server
        console logs.
      </p>

      <p>This project fulfills the following user stories:</p>

      <ol>
        <li>
          Only allow your site to be loading in an iframe on your own pages.
        </li>
        <li>Do not allow DNS prefetching.</li>
        <li>Only allow your site to send the referrer for your own pages.</li>
        <li>
          I can <b>POST</b> a thread to a specific message board by passing form
          data <code>text</code> and <code>delete_password</code> to
          <samp>/api/threads/{board}</samp>. (Recomend
          <code>res.redirect</code> to board page <samp>/b/{board}</samp>) Saved
          will be <code>_id</code>, <code>text</code>,
          <code>created_on</code> (date&amp;time),
          <code>bumped_on</code> (date&amp;time, starts same as created_on),
          <code>reported</code> (boolean), <code>delete_password</code>, &amp;
          <code>replies</code> (array).
        </li>
        <li>
          I can <b>POST</b> a reply to a thead on a specific board by passing
          form data <code>text</code>, <code>delete_password</code>, &amp;
          <code>thread_id</code> to <samp>/api/replies/{board}</samp> and it
          will also update the <code>bumped_on</code> date to the comment's
          date. (Recomend <code>res.redirect</code> to thread page
          <samp>/b/{board}/{thread_id}</samp>) In the thread's
          <code>replies</code> array will be saved <code>_id</code>,
          <code>text</code>, <code>created_on</code>,
          <code>delete_password</code>, &amp; <code>reported</code>.
        </li>
        <li>
          I can <b>GET</b> an array of the most recent 10 bumped threads on the
          board with only the most recent 3 replies from
          <samp>/api/threads/{board}</samp>. The <code>reported</code> and
          <code>delete_password</code> fields will not be sent.
        </li>
        <li>
          I can <b>GET</b> an entire thread with all its replies from
          <samp>/api/replies/{board}?thread_id={thread_id}</samp>. Also hiding
          the same fields.
        </li>
        <li>
          I can delete a thread completely if I send a
          <b>DELETE</b> request to <samp>/api/threads/{board}</samp> and pass
          along the <code>thread_id</code> &amp; <code>delete_password</code>.
          (Text response will be <code>"incorrect password"</code> or
          <code>"success"</code>)
        </li>
        <li>
          I can delete a post (just changing the text to
          <code>"[deleted]"</code>) if I send a <b>DELETE</b> request to
          <samp>/api/replies/{board}</samp> and pass along the
          <code>thread_id</code>, <code>reply_id</code>, &amp;
          <code>delete_password</code>. (Text response will be
          <code>"incorrect password"</code> or <code>"success"</code>)
        </li>
        <li>
          I can report a thread and change its <code>reported</code> value to
          <code>true</code> by sending a <b>PUT</b> request to
          <samp>/api/threads/{board}</samp> and passing along the
          <code>thread_id</code>. (Text response will be <code>"success"</code>)
        </li>
        <li>
          I can report a reply and change its <code>reported</code> value to
          <code>true</code> by sending a <b>PUT</b> request to
          <samp>/api/replies/{board}</samp> and passing along the
          <code>thread_id</code> &amp; <code>reply_id</code>. (Text response
          will be <code>"success"</code>)
        </li>
        <li>
          Complete functional tests that
          <span
            tabindex="0"
            data-toggle="tooltip"
            data-placement="bottom"
            data-html="true"
            title="<em>Wholly test routes, Batman!</em>"
            style="text-decoration: dotted underline; cursor: help;"
            >wholly test routes</span
          >
          and pass.
        </li>
      </ol>
    </div>

    <!-- Glitch button -->
    <div
      class="glitchButton"
      style="position:absolute;top:20px;right:20px;"
    ></div>
    <script src="https://button.glitch.me/button.js"></script>

    <!-- prettier-ignore -->
    <span>
      <!-- jQuery -->
      <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <!-- Popper -->
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <!-- Bootstrap -->
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>      
      <!-- highlight.js -->
      <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
    </span>

    <!-- Page scripts -->
    <script src="/public/client.js"></script>
    <script>
      $(function() {
        $('[data-toggle="tooltip"]').tooltip();
      });
    </script>
  </body>
</html>
